<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PadaONE Security</title>
    
    <style>
        #app-root {
            transition: filter 0.2s ease-in-out;
            filter: blur(0px);
        }
        #app-root.fade-out {
            filter: blur(10px);
            pointer-events: none;
        }
    </style>

    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/flowcharts.css">
</head>
<body>
    <div id="app-root"></div>

    <script>
        // Mapa de páginas disponíveis
        const pages = {
            'dashboard': 'dashboard.html',
            'logic': 'bibliotecas.html',
            'trivy': 'trivy.html',
            'semgrep': 'semgrep.html',
            'gitleaks': 'gitleaks.html'
        };

        // Função para carregar página dinamicamente
        function loadPage(pageName) {
            const filePath = pages[pageName] || 'dashboard.html';
            const appRoot = document.getElementById('app-root');
            
            // Fade out
            appRoot.classList.add('fade-out');
            
            // Espera o fade out completar antes de trocar conteúdo
            setTimeout(() => {
                fetch(filePath)
                    .then(response => response.text())
                    .then(html => {
                        // Extrai apenas o conteúdo do body
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        appRoot.innerHTML = doc.body.innerHTML;
                        
                        // Reexecuta scripts carregados
                        const scripts = doc.body.querySelectorAll('script');
                        scripts.forEach(script => {
                            const newScript = document.createElement('script');
                            if (script.src) {
                                newScript.src = script.src;
                            } else {
                                newScript.textContent = script.textContent;
                            }
                            document.body.appendChild(newScript);
                        });

                        // Inicializar âncoras internas após carregar
                        if (typeof utils !== 'undefined' && utils.initAnchorLinks) {
                            utils.initAnchorLinks();
                        }
                        
                        // Fade in
                        appRoot.classList.remove('fade-out');
                    })
                    .catch(error => {
                        console.error('Erro ao carregar página:', error);
                        appRoot.innerHTML = '<p>Erro ao carregar a página.</p>';
                        appRoot.classList.remove('fade-out');
                    });
            }, 200);
        }

        // Carrega a página inicial
        window.addEventListener('load', () => {
            loadPage('dashboard');
        });

        // Monitora mudanças de hash para navegação
        window.addEventListener('hashchange', () => {
            const page = window.location.hash.slice(1) || 'dashboard';
            loadPage(page);
        });
    </script>
</body>
</html>
